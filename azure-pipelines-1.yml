trigger:
  branches:
    include:
      - master

pool:
  vmImage: 'ubuntu-latest'  # ya trae Docker preinstalado

variables:
  PROJECT_NAME: 'uptimestars'

steps:

# ðŸ‘‡ Ya NO se necesita instalar Docker

- script: docker --version
  displayName: 'Verificar versiÃ³n de Docker'

- task: DockerCompose@1
  displayName: 'Build & run Docker Compose'
  inputs:
    containerregistrytype: 'Container Registry'
    dockerComposeFile: 'Uptime.Stars.Backend/docker-compose.yml'
    action: 'Run services'
    projectName: '$(PROJECT_NAME)'
    buildImages: true

- script: |
    echo "Esperando que los servicios se inicien..."
    sleep 20
  displayName: 'Delay startup'

- script: |
    curl -sf http://localhost:8080 || (echo "API no responde" && exit 1)
  displayName: 'Validar API'
